---
title: "Vue 源码学习 (2) - Vue 初始化"
created: "2022-06-26T11:36:24Z"
updated: "2022-06-26T11:36:24Z"
draft: false
---

# _init 
当我们使用  时，我们会用  实例化一个应用

然后[上一节](https://github.com/vivipure/blog/issues/14)中，我们也看到了  的真实面目 - 构造函数，实例化时会调用  方法.

找到 文件中，函数执行时挂载了 方法


这里的逻辑我大致讲一下，
1.  递增
2. 往实例上加一些属性标识
3.  初始化，合并 ,  等
4. 初始化声明周期，初始化 
5. 
6. 初始化 
7. 初始化  ->  ->  ->  -> 
8. 初始化 
9. 
10. 开始 

# 
上面的流程大致过下，接下来我们看看  执行的过程。

在 中我们讲过，这里将  函数引入进来，用于讲  转化成  函数，这里我们也讲一下详细的逻辑


来到 ， 这里就是  时 方法

这里调用了 的  方法

这里实例化了一个 渲染的 , 在它的回调中会调用  方法，执行 ， 更新 

这里还有一个判断 , 这里  表示父 ，为  则表示为根结点的实例.

Watcher 我们先不看，这主要是响应式原理和依赖收集相关的部分，我们继续看  ,  方法的逻辑.

# _render
在 中， 函数注册了  方法.

 函数调用  生成  进行返回

平时我们使用  函数时是这么写的：

这里的  就对应了 , 而  就是响应式的数据

其中  在  时进行了注册，实际上也是对  方法进行了封装。

# createElement
在 中定义了  函数，该函数是对  的封装，让参数更加灵活


这里主要执行的逻辑是，先将  规范为  数组， 标识规范类型。

然后创建 , 对  进行判断,
- . 如果是  是  类型
	- . 内置  元素的话，直接创建普通 
	- . 已经注册过的组件名，则使用  创建组件 
	- . 创建未知标签的 
- . 如果是  类型，直接创建  组件 

到这里我们大致讲完了  的逻辑了。

# update
在 方法中，执行完成后，会执行 方法

查看  方法

这里的核心逻辑是  方法. 由于  不只面向  平台， 也会处理其他平台的逻辑，例如**死去的** . 而且在  时，也是不需要 。这里我们看   方法。


这里主要通过  创建元素

这里的逻辑就是通过  创建正式的  然后插入到它的父节点中。

这里先创建  元素，然后创建 ，遍历子节点，递归调用 , 然后调用 。

最后调用  方法插入到 父节点，所以插入节点的顺序是 子>父 的。

# 总结
最后回顾下整个 Vue 初始化的流程：
1.  初始化声明周期，数据
2.  开始挂载
3. 
4.  生成 
5.   到  上

从  的过程我们也知道了从 虚拟节点 到 DOM 的一个生成逻辑，所以有一个常见的面试题，就是父子组件的生命周期问题，这个问题的答案现在就很简单了


上面我们大致讲了下  的过程，很多关于 新旧节点的比较逻辑，diff 算法优化并没有细聊。后续会有文章, 我们接着聊。
